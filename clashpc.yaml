# Config Clash Verge PC (FIXED VERSION)
hosts:
  'bug': [104.18.3.2, 104.18.2.2]

# Template settings
prof: &prof {type: http, size-limit: 15000, interval: 10800, health-check: {enable: true, url: http://connectivitycheck.gstatic.com/generate_204, interval: 3600}}

global-client-fingerprint: random
log-level: silent
routing-mark: 6666
mode: rule
port: 7890
socks-port: 7891
redir-port: 7892
tproxy-port: 7893
ipv6: true
allow-lan: true
unified-delay: true
tcp-concurrent: true

# Hapus baris interface-name jika di Windows agar auto-detect
# interface-name: en0 

profile:
  store-selected: true
  store-fake-ip: true

geodata-mode: true

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: false
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - +.v2ex.com
    - +.google.com
  skip-domain:
    - bakrie.ac.id
    - unnes.ac.id
    - space.byu.id
    - api.zoom.us
    - quiz.vidio.com
    - help.viu.com
    - www.udemy.com
    - ava.game.naver.com

dns:
  enable: true
  prefer-h3: true
  use-hosts: true
  use-system-hosts: true
  respect-rules: true
  listen: 0.0.0.0:53
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  nameserver:
    - system
    - 'https://8.8.8.8/dns-query#ecs=223.5.5.0/24&ecs-override=true'
    - 'https://1.1.1.1/dns-query#ecs=223.5.5.0/24&ecs-override=true'
  fallback:
    - system
    - 1.1.1.1
    - 1.0.0.1
    - 8.8.8.8
    - 8.8.4.4
  proxy-server-nameserver:
    - system
    - 'https://mozilla.cloudflare-dns.com/dns-query#DNS&h3=true'
    - 'https://mozilla.cloudflare-dns.com/dns-query#skip-cert-verify=true'
  fallback-filter:
    geosite: [gfw]

proxy-groups:
  # Grup utama semua internet
  - name: UMUM
    type: select
    proxies:
      - AUTO ALL
      - DIRECT
    include-all-providers: true
    exclude-filter: UDP # Filter agar akun UDP tidak masuk ke browsing biasa
    lazy: true

  # Grup khusus UDP (game, VoIP, dll)
  - name: UDP
    type: select
    proxies:
      - Server UDP
      - DIRECT # "PASS" diganti DIRECT
    use: [udp2]
    lazy: true

  # Konten dewasa
  - name: porn
    type: select
    proxies:
      - DIRECT # "PASS" diganti DIRECT
      - REJECT
    lazy: true

  # Iklan web
  - name: IKLANWEB
    type: select
    proxies:
      - REJECT # Iklan default diblokir
      - DIRECT # Iklan diizinkan
    lazy: true

  # Otomatis pilih node terbaik (Kecuali UDP)
  - name: AUTO ALL
    type: fallback
    include-all-providers: true
    exclude-filter: UDP
    url: 'http://connectivitycheck.gstatic.com/generate_204'
    interval: 300
    lazy: true

  # Fallback khusus server UDP
  - name: Server UDP
    type: fallback
    use: [udp2]
    url: 'http://connectivitycheck.gstatic.com/generate_204'
    interval: 600
    tolerance: 100

proxy-providers:
  AID 1:
    url: https://raw.githubusercontent.com/oranglemah/khusus/refs/heads/main/test.noice.id.txt
    path: ./ava
    override:
      skip-cert-verify: true
      packet-encoding: xudp
      network: tcp
      smux: {enabled: true}
      additional-prefix: 'ava '
    <<: *prof

  AID 2:
    url: https://raw.githubusercontent.com/oranglemah/khusus/refs/heads/main/vpnava.txt
    path: ./ava2
    override:
      skip-cert-verify: true
      packet-encoding: xudp
      network: tcp
      smux: {enabled: true}
      additional-prefix: 'ava2 '
    <<: *prof

  AID 3:
    url: https://raw.githubusercontent.com/oranglemah/khusus/refs/heads/main/ava%20vless.txt
    path: ./ava1
    override:
      skip-cert-verify: true
      packet-encoding: xudp
      network: tcp
      smux: {enabled: true}
      additional-prefix: 'ava2 '
    <<: *prof

  AID 4:
    url: https://raw.githubusercontent.com/oranglemah/khusus/refs/heads/main/vpnavaSG.txt
    path: ./ava3
    override:
      skip-cert-verify: true
      packet-encoding: xudp
      network: tcp
      smux: {enabled: true}
      additional-prefix: 'ava3 '
    <<: *prof

  xl-edu:
    url: https://raw.githubusercontent.com/oranglemah/khusus/refs/heads/main/edusg.txt
    path: ./xl-edu
    override:
      skip-cert-verify: true
      packet-encoding: xudp
      network: tcp
      smux: {enabled: true}
      additional-prefix: 'xl-edu '
    <<: *prof

  xl-edu2:
    url: https://raw.githubusercontent.com/oranglemah/khusus/refs/heads/main/eduwc.txt
    path: ./xl-edu2
    override:
      skip-cert-verify: true
      packet-encoding: xudp
      network: tcp
      smux: {enabled: true}
      additional-prefix: 'xl-edu2 '
    <<: *prof

  edu:
    url: https://raw.githubusercontent.com/oranglemah/khusus/refs/heads/main/eduID.txt
    path: ./edu
    override:
      skip-cert-verify: true
      packet-encoding: xudp
      network: tcp
      smux: {enabled: true}
      additional-prefix: 'edu '
    <<: *prof

  udp2:
    url: https://raw.githubusercontent.com/oranglemah/khusus/refs/heads/main/udp.txt
    path: ./UDP2
    override:
      skip-cert-verify: true
      packet-encoding: xudp
      network: tcp
      smux: {enabled: true}
      additional-prefix: 'UDP '
    <<: *prof

rule-providers:
  malware:
    type: http
    format: text
    behavior: domain
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/malware.txt
    path: ./ruleset/malware.txt
    interval: 86400

  phishing:
    type: http
    format: text
    behavior: domain
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/phishing.txt
    path: ./ruleset/phishing.txt
    interval: 86400

  torrent:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Download/Download.yaml
    path: ./ruleset/torrent.yaml
    interval: 86400

  browser: # Typo fixed
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-Browser.yaml
    path: ./ruleset/browser.yaml
    interval: 86400

  google:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-GoogleFamily.yaml
    path: ./ruleset/google.yaml
    interval: 86400

  sosmed:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-SocialMedia.yaml
    path: ./ruleset/sosialmed.yaml
    interval: 86400

  wa:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-WhatsApp.yaml
    path: ./ruleset/wa.yaml
    interval: 86400

  dewasa:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-NSFW18%2B.yaml
    path: ./ruleset/dewasa.yaml
    interval: 86400

  youtube:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-Streaming.yaml
    path: ./ruleset/youtube.yaml
    interval: 86400

  bank:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-MarketBank.yaml
    path: ./ruleset/bank.yaml
    interval: 86400

  cloudflare:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-Cloudflare.yaml
    path: ./ruleset/cloudflare.yaml
    interval: 86400

  speedtest:
    type: http
    format: yaml
    behavior: domain
    url: https://raw.githubusercontent.com/Zulfatok/Rule_provider/refs/heads/main/rule_provider/SANZ-SpeedTest.yaml
    path: ./ruleset/speedtest.yaml
    interval: 86400

rules:
  # 1. Block Malware & Phishing
  - RULE-SET,malware,REJECT
  - RULE-SET,phishing,REJECT
  - RULE-SET,torrent,REJECT
  - RULE-SET,dewasa,porn

  # 2. Direct untuk Banking & Speedtest (PENTING biar M-Banking aman)
  - RULE-SET,bank,DIRECT
  - RULE-SET,speedtest,DIRECT

  # 3. LAN & Local IP Direct
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,224.0.0.0/4,DIRECT

  # 4. Port System Direct
  - DST-PORT,53,DIRECT
  - DST-PORT,123/136/137-139,DIRECT
  - SRC-PORT,123/136/137-139,DIRECT,udp

  # 5. Route Trafik UDP ke grup UDP
  - NETWORK,UDP,UDP

  # 6. Sisanya (Browsing, WA, YouTube) masuk UMUM
  - MATCH,UMUM
